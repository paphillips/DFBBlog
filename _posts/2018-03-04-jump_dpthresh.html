---
layout:        default
title:         Datapath threshold flag jump
categories:    [Examples]
thumb:         
summary:       Example of using datapath threshold flag to branch (asserted when the ALU detects a sign change). Stage_A input results in several sign changes as output goes from positive to negative and back
---
<div id="contentcontainer">  <h1>Datapath threshold flag jump</h1>  <p>Example of using datapath threshold flag to branch (asserted when the ALU detects a sign change). Stage_A input results in several sign changes as output goes from positive to negative and back</p>  <pre class="language-asmcypressdfb line-numbers"><code>// [title] Datapath threshold flag jump// [brief] Example of using datapath threshold flag to branch (asserted when the ALU detects a sign change). Stage_A input results in several sign changes as output goes from positive to negative and backinit:    // ----------------------------------------    // Load the next Stage_A value and subtract    // [SUBTRACTION_VAL_1] in DataRam_A from it    // ----------------------------------------    // Initialize    // [acu]    Ensure we are positioned on [SUBTRACTION_VAL_1] at 0x00    acu(clear, clear) dmux(sa, sa) alu(hold) mac(hold)            // [dmux].a     Set up to read bus Stage_A to ALU    // [dmux].b     Set up to read [SUBTRACTION_VAL_1] from DataRam_A to ALU    // [alu]        Set up to subtract b from a with threshold detection    acu(hold, hold) addr(1) dmux(ba, sra) alu(tsubb) mac(hold)    // Pipeline delay    // [alu]        Data values are loaded off the datapath    acu(hold, hold) dmux(sa, sa) alu(hold) mac(hold)    // Unconditional jump: go to [dpsign_check]    // [alu]        ALU output is put on the datapath    acu(hold, hold) dmux(sa, sa) alu(hold) mac(hold) jmp(dpthresh, sign_changed)sign_did_not_change:    // --------------------------------------------------    // This branch is entered when [alu].a - [alu].b &gt;= 0    // --------------------------------------------------    // Unconditional jump: return to [init]    acu(hold, hold) dmux(sa, sa) alu(hold) mac(hold) jmp(eob, init)sign_changed:    // --------------------------------------------------    // This branch is entered when [alu].a - [alu].b &lt; 0    // --------------------------------------------------    // Unconditional jump: return to [init]    acu(hold, hold) dmux(sa, sa) alu(hold) mac(hold) jmp(eob, init)area data_borg 0dw 0x000004    // [SUBTRACTION_VAL_1]</code></pre>  <h2>Jump Diagram</h2>  <figure class="figure">    <object type="image/svg+xml" data="/assets/svg/2018-03-04-jump_dpthresh-JumpDiagram.svg">Your browser does not support SVG</object>    <figcaption class="figure-caption">Call Diagram for this program from the DFB Assembler Mini IDE</figcaption>  </figure>  <h2>Instruction Detail</h2>  <h2>init</h2>  <section id="init" class="p-4">    <h3>Line 13</h3>    <pre class="language-asmcypressdfb line-numbers" data-start="13"><code>acu(clear, clear) dmux(sa, sa) alu(hold) mac(hold)</code></pre>    <table class="table table-sm table-hover dfb">      <thead>        <tr>          <th scope="col">Instr</th>          <th scope="col"></th>          <th scope="col">Description</th>        </tr>      </thead>      <tbody>        <tr>          <td>            <span class="badge badge-primary">acu</span>          </td>          <td>            <span class="badge badge-primary">A</span>          </td>          <td>            <span>Sets reg to 0, put 0 on the output</span>          </td>        </tr>        <tr>          <td>            <span class="badge badge-primary">acu</span>          </td>          <td>            <span class="badge badge-primary">B</span>          </td>          <td>            <span>Sets reg to 0, put 0 on the output</span>          </td>        </tr>        <tr>          <td>            <span class="badge badge-primary">dmux</span>          </td>          <td>            <span class="badge badge-primary">A</span>          </td>          <td>            <span>Shifter to ALU</span>          </td>        </tr>        <tr>          <td>            <span class="badge badge-primary">dmux</span>          </td>          <td>            <span class="badge badge-primary">B</span>          </td>          <td>            <span>Shifter to ALU</span>          </td>        </tr>        <tr>          <td>            <span class="badge badge-primary">alu</span>          </td>          <td>            <span class="badge badge-primary"></span>          </td>          <td>            <span>Holds the ALU output from the previous cycle.</span>          </td>        </tr>        <tr>          <td>            <span class="badge badge-primary">mac</span>          </td>          <td>            <span class="badge badge-primary"></span>          </td>          <td>            <span>Holds the accumulator, no multiply (no power in mult)</span>          </td>        </tr>      </tbody>    </table>    <h3>Line 18</h3>    <pre class="language-asmcypressdfb line-numbers" data-start="18"><code>acu(hold, hold) addr(1) dmux(ba, sra) alu(tsubb) mac(hold)</code></pre>    <table class="table table-sm table-hover dfb">      <thead>        <tr>          <th scope="col">Instr</th>          <th scope="col"></th>          <th scope="col">Description</th>        </tr>      </thead>      <tbody>        <tr>          <td>            <span class="badge badge-primary">acu</span>          </td>          <td>            <span class="badge badge-primary">A</span>          </td>          <td>            <span>Puts reg on the output</span>          </td>        </tr>        <tr>          <td>            <span class="badge badge-primary">acu</span>          </td>          <td>            <span class="badge badge-primary">B</span>          </td>          <td>            <span>Puts reg on the output</span>          </td>        </tr>        <tr>          <td>            <span class="badge badge-primary">Stage In</span>          </td>          <td>            <span class="badge badge-primary">A</span>          </td>          <td>            <span>Selected for read</span>          </td>        </tr>        <tr>          <td>            <span class="badge badge-primary">dmux</span>          </td>          <td>            <span class="badge badge-primary">A</span>          </td>          <td>            <span>Bus to ALU. </span>          </td>        </tr>        <tr>          <td>            <span class="badge badge-primary">dmux</span>          </td>          <td>            <span class="badge badge-primary">B</span>          </td>          <td>            <span>Shifter to RAM, RAM to ALU</span>          </td>        </tr>        <tr>          <td rowspan="2">            <span class="badge badge-primary">alu</span>          </td>          <td rowspan="2">            <span class="badge badge-primary"></span>          </td>          <td>            <span>Puts A â€“ B on the ALU output, sets threshold detection</span>          </td>        </tr>        <tr>          <td>            <span class="badge badge-success">User comment</span> Set up to subtract b from a with threshold detection</td>        </tr>        <tr>          <td>            <span class="badge badge-primary">mac</span>          </td>          <td>            <span class="badge badge-primary"></span>          </td>          <td>            <span>Holds the accumulator, no multiply (no power in mult)</span>          </td>        </tr>      </tbody>    </table>    <h3>Line 22</h3>    <pre class="language-asmcypressdfb line-numbers" data-start="22"><code>acu(hold, hold) dmux(sa, sa) alu(hold) mac(hold)</code></pre>    <table class="table table-sm table-hover dfb">      <thead>        <tr>          <th scope="col">Instr</th>          <th scope="col"></th>          <th scope="col">Description</th>        </tr>      </thead>      <tbody>        <tr>          <td>            <span class="badge badge-primary">acu</span>          </td>          <td>            <span class="badge badge-primary">A</span>          </td>          <td>            <span>Puts reg on the output</span>          </td>        </tr>        <tr>          <td>            <span class="badge badge-primary">acu</span>          </td>          <td>            <span class="badge badge-primary">B</span>          </td>          <td>            <span>Puts reg on the output</span>          </td>        </tr>        <tr>          <td>            <span class="badge badge-primary">dmux</span>          </td>          <td>            <span class="badge badge-primary">A</span>          </td>          <td>            <span>Shifter to ALU</span>          </td>        </tr>        <tr>          <td>            <span class="badge badge-primary">dmux</span>          </td>          <td>            <span class="badge badge-primary">B</span>          </td>          <td>            <span>Shifter to ALU</span>          </td>        </tr>        <tr>          <td rowspan="2">            <span class="badge badge-primary">alu</span>          </td>          <td rowspan="2">            <span class="badge badge-primary"></span>          </td>          <td>            <span>Holds the ALU output from the previous cycle.</span>          </td>        </tr>        <tr>          <td>            <span class="badge badge-success">User comment</span> Data values are loaded off the datapath</td>        </tr>        <tr>          <td>            <span class="badge badge-primary">mac</span>          </td>          <td>            <span class="badge badge-primary"></span>          </td>          <td>            <span>Holds the accumulator, no multiply (no power in mult)</span>          </td>        </tr>      </tbody>    </table>    <h3>Line 26</h3>    <pre class="language-asmcypressdfb line-numbers" data-start="26"><code>acu(hold, hold) dmux(sa, sa) alu(hold) mac(hold) jmp(dpthresh, sign_changed)</code></pre>    <table class="table table-sm table-hover dfb">      <thead>        <tr>          <th scope="col">Instr</th>          <th scope="col"></th>          <th scope="col">Description</th>        </tr>      </thead>      <tbody>        <tr>          <td>            <span class="badge badge-primary">acu</span>          </td>          <td>            <span class="badge badge-primary">A</span>          </td>          <td>            <span>Puts reg on the output</span>          </td>        </tr>        <tr>          <td>            <span class="badge badge-primary">acu</span>          </td>          <td>            <span class="badge badge-primary">B</span>          </td>          <td>            <span>Puts reg on the output</span>          </td>        </tr>        <tr>          <td>            <span class="badge badge-primary">dmux</span>          </td>          <td>            <span class="badge badge-primary">A</span>          </td>          <td>            <span>Shifter to ALU</span>          </td>        </tr>        <tr>          <td>            <span class="badge badge-primary">dmux</span>          </td>          <td>            <span class="badge badge-primary">B</span>          </td>          <td>            <span>Shifter to ALU</span>          </td>        </tr>        <tr>          <td rowspan="2">            <span class="badge badge-primary">alu</span>          </td>          <td rowspan="2">            <span class="badge badge-primary"></span>          </td>          <td>            <span>Holds the ALU output from the previous cycle.</span>          </td>        </tr>        <tr>          <td>            <span class="badge badge-success">User comment</span> ALU output is put on the datapath</td>        </tr>        <tr>          <td>            <span class="badge badge-primary">mac</span>          </td>          <td>            <span class="badge badge-primary"></span>          </td>          <td>            <span>Holds the accumulator, no multiply (no power in mult)</span>          </td>        </tr>      </tbody>    </table>  </section>  <h2>sign_did_not_change</h2>  <section id="sign_did_not_change" class="p-4">    <h3>Line 34</h3>    <pre class="language-asmcypressdfb line-numbers" data-start="34"><code>acu(hold, hold) dmux(sa, sa) alu(hold) mac(hold) jmp(eob, init)</code></pre>    <table class="table table-sm table-hover dfb">      <thead>        <tr>          <th scope="col">Instr</th>          <th scope="col"></th>          <th scope="col">Description</th>        </tr>      </thead>      <tbody>        <tr>          <td>            <span class="badge badge-primary">acu</span>          </td>          <td>            <span class="badge badge-primary">A</span>          </td>          <td>            <span>Puts reg on the output</span>          </td>        </tr>        <tr>          <td>            <span class="badge badge-primary">acu</span>          </td>          <td>            <span class="badge badge-primary">B</span>          </td>          <td>            <span>Puts reg on the output</span>          </td>        </tr>        <tr>          <td>            <span class="badge badge-primary">dmux</span>          </td>          <td>            <span class="badge badge-primary">A</span>          </td>          <td>            <span>Shifter to ALU</span>          </td>        </tr>        <tr>          <td>            <span class="badge badge-primary">dmux</span>          </td>          <td>            <span class="badge badge-primary">B</span>          </td>          <td>            <span>Shifter to ALU</span>          </td>        </tr>        <tr>          <td>            <span class="badge badge-primary">alu</span>          </td>          <td>            <span class="badge badge-primary"></span>          </td>          <td>            <span>Holds the ALU output from the previous cycle.</span>          </td>        </tr>        <tr>          <td>            <span class="badge badge-primary">mac</span>          </td>          <td>            <span class="badge badge-primary"></span>          </td>          <td>            <span>Holds the accumulator, no multiply (no power in mult)</span>          </td>        </tr>      </tbody>    </table>  </section>  <h2>sign_changed</h2>  <section id="sign_changed" class="p-4">    <h3>Line 42</h3>    <pre class="language-asmcypressdfb line-numbers" data-start="42"><code>acu(hold, hold) dmux(sa, sa) alu(hold) mac(hold) jmp(eob, init)</code></pre>    <table class="table table-sm table-hover dfb">      <thead>        <tr>          <th scope="col">Instr</th>          <th scope="col"></th>          <th scope="col">Description</th>        </tr>      </thead>      <tbody>        <tr>          <td>            <span class="badge badge-primary">acu</span>          </td>          <td>            <span class="badge badge-primary">A</span>          </td>          <td>            <span>Puts reg on the output</span>          </td>        </tr>        <tr>          <td>            <span class="badge badge-primary">acu</span>          </td>          <td>            <span class="badge badge-primary">B</span>          </td>          <td>            <span>Puts reg on the output</span>          </td>        </tr>        <tr>          <td>            <span class="badge badge-primary">dmux</span>          </td>          <td>            <span class="badge badge-primary">A</span>          </td>          <td>            <span>Shifter to ALU</span>          </td>        </tr>        <tr>          <td>            <span class="badge badge-primary">dmux</span>          </td>          <td>            <span class="badge badge-primary">B</span>          </td>          <td>            <span>Shifter to ALU</span>          </td>        </tr>        <tr>          <td>            <span class="badge badge-primary">alu</span>          </td>          <td>            <span class="badge badge-primary"></span>          </td>          <td>            <span>Holds the ALU output from the previous cycle.</span>          </td>        </tr>        <tr>          <td>            <span class="badge badge-primary">mac</span>          </td>          <td>            <span class="badge badge-primary"></span>          </td>          <td>            <span>Holds the accumulator, no multiply (no power in mult)</span>          </td>        </tr>      </tbody>    </table>  </section></div>