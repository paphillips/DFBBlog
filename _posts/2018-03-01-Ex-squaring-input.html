---
layout: 	default
title: 		"Example: squaring an input"
categories: [Examples]
thumb:		
summary: 	"Example demonstrating a calculation to square the input value"
---
<h1>Example: squaring an input</h1>
<hr>
<p>This is a basic example of how to square the value coming in on the Stage input.</p>
<div class="content">
	<pre class="language-asmcypressdfb line-numbers"><code>
initial:
    // ------------------------
    // Setup and initialization
    // ------------------------

    // [acu]    Clear
    // [alu]    Set to zero
    acu(clear, clear) dmux(sa, sa) alu(set0) mac(hold)

    // Unconditional jump to [wait_for_in1]
    acu(hold, hold) dmux(sa, sa) alu(hold) mac(hold) jmp(eob, wait_for_in1)

wait_for_in1:
    // -------------------------------------------------------
    // Wait for data to be written to Staging Register Input 1
    // -------------------------------------------------------

    // JUMP:    Is value [in1] register populated with Stage_A data?
    //          [True]   Value loaded - go to [dataRead]
    //          [False]  Loop to [wait_for_in1]
    // [dmux]   Set up to load Stage_A value into [mac].a and [mac].b
    // [mac]    Set up to multiply a * b without adding any accumulated value
    acu(hold, hold) addr(1) dmux(bm, bm) alu(hold) mac(clra) jmpl(in1, dataRead)

dataRead:
    // -----------------------------------------
    // Run the calculation and output the result
    // -----------------------------------------

    // [mac]    Loads a and b from Stage_A -> Mux_0 -> Mux_1 -> Mux_2 -> mac
    acu(hold, hold) dmux(sm, sm) alu(seta) mac(hold)

    // [mac]    Multiplication of a and b is output
    // [alu]    Set up to output mac result
    acu(hold, hold) dmux(sa, sa) alu(hold) mac(hold)

    // [alu]    Output mac result
    acu(hold, hold) dmux(sm, sm) alu(seta) mac(hold)

    // [write]  Write calculation result to [Hold_A]
    acu(hold, hold) addr(1) dmux(sm, sm) alu(hold) mac(hold) write(abus) jmp(eob, wait_for_in1)</code></pre>

	<h2>Branch Structure Synopsis</h2>
	<ul>
		<li>initial:</li>
			<ul><li>Initialization routine</li></ul>
		<li>wait_for_in1:</li>
		<ul>
			<li>We enter a wait state pending arrival of a sample on the Stage_A bus. Stage_A is selected because addr(1) has been specified with the 'bm' dmux instruction. addr(0) would pull from Stage_B.</li>
			<li>If there is no sample available we loop due to jump instruction 'jumpl' (jump condition in1==false)
			<li>Once a sample arrives (jump condition in1==true) we jump to the dataread label</li>
		</ul>
		<li>dataRead:</li>
		<ul>
			<li>The bulk of the calculations occur here</li>
		</ul>
	</ul>
	
	<h3>Jump Diagram</h3>
	<p>The branching just alternates between the two states after initial:</p>
	<figure class="figure">
		<object type="image/svg+xml" data="/assets/svg/2018-03-01-Ex-squaring-input-jump.svg">Your browser does not support SVG</object>
		<figcaption class="figure-caption">A sample of the DFB Assembler Mini IDE Call Diagram.</figcaption>
	</figure>
	
	<h2>Calculation Synopsis</h2>
	
	<pre class="language-asmcypressdfb line-numbers" data-start="24"><code>acu(hold, hold) addr(1) dmux(bm, bm) alu(hold) mac(clra) jmpl(in1, dataRead)></code></pre>
	<table class="table table-sm table-hover">
	  <tbody>
		<tr>
			<td class="table-secondary"><span class="badge badge-secondary">acu</span></td>
			<td></td>
		</tr>
		<tr>
			<td class="table-secondary"><span class="badge badge-secondary">addr</span></td>
			<td></td>
		</tr>
		<tr>
			<td class="table-secondary"><span class="badge badge-primary">dmux</span></td>
			<td>Set up to connect the Stage_A bus in to the mac</td>
		</tr>
		<tr>
			<td class="table-secondary"><span class="badge badge-primary">alu</span></td>
			<td>Set up to specify a clra instruction to ensure that the accumulator is zero - we are squaring the input with no addition</td>
		</tr>
		<tr>
			<td class="table-secondary"><span class="badge badge-primary">mac</span></td>
			<td></td>
		</tr>
		<tr>
			<td class="table-secondary"><span class="badge badge-secondary">other</span></td>
			<td></td>
		</tr>
		<tr>
			<td class="table-secondary"><span class="badge badge-primary">jmp</span></td>
			<td></td>
		</tr>
	  </tbody>
	</table>

	
</div>